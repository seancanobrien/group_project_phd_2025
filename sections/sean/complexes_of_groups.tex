\subsection{Complexes of groups}
We will now define complexes of groups.
These will be a generalisation of graphs of groups and that theory can be recovered by realising graphs as scwols, exactly as in \cref{eg:K3_scwol}.
To motivate this construction, we will recall that graphs of groups emerge from actions of groups on trees.
Complexes of groups \emph{sometimes} emerge from an action of a group on a scwol, such a complex of groups is called \emph{developable}.
The general definition of a complex of groups abstracts the properties of developable complexes of groups.
We will first give the abstract definition of a complex of groups, then, to motivate these properties, we will define the construction of a complex of groups associated to an action.
Given a group $G$, let $\ad(g) \colon G \to G$ denote conjugation, $\ad(g)(h) = g^{-1}hg$.

\begin{definition}
	Given a scwol $\catx$, A complex of groups $G(\catx)$ = $(G_\sigma, \phi_a, g_{a,b})$ over $\catx$ consists of the following data.
	\begin{enumerate}
		\item A group $G_\sigma$ for each $\sigma \in V(\catx)$.
		\item An injective homomorphism $\phi_a \colon G_{i(a)} \to G_{t(a)}$ for each $a \in E(\catx)$.
		\item An element $g_{a,b} \in G_{t(a)}$ for each composable pair $(b,a) \in E^{(2)}(\catx)$.
	\end{enumerate}
	The groups $G_\sigma$ are called \emph{local groups}, and the $\phi_a$ are called \emph{edge homomorphisms}.
	The elements $g_{a,b}$ are called \emph{twisting elements}.
	These twisting elements must satisfy the following compatibility conditions.
	\begin{enumerate}
		\item $\ad(g_{a,b}) \phi_{ab} = \phi_a \phi_b$.
		\item $\phi_a(g_{b,c})g_{a,bc} = g_{a,b}g_{ab,c}$.
	\end{enumerate}
	We call a complex of groups \emph{simple} if all the twisting elements are the identity.
	\label{def:complex_of_groups}
\end{definition}

In this notation, the $G$ in $G(\catx)$ is not associated to any specific group, just that the structure of a complex of groups has been associated to the scwol $\catx$.
Note that compatibility condition (1) is vacuous if the dimension of $\catx$ is less than 2.
Compatibility condition (2) is vacuous if the dimension of  $\catx$ is less than 3.
Compatibility condition (1) states that, up to conjugation by a twisting element, we can compose homomorphisms along composable edges in the obvious way.
Then in this context, compatibility condition (2) states that this composition is associative.
To see this, we will use the following diagram.

\[
	\begin{tikzcd}
		G_\sigma \ar[r, "\phi_c"] \ar[rr, bend left, "\phi_{bc}"] & G_\tau \ar[r, "\phi_b"] \ar[rr, bend right, "\phi_{ab}"'] & G_\mu \ar[r, "\phi_a"] & G_\nu
	\end{tikzcd}
	.\]
We could compose $\phi_a\phi_b\phi_c$ as $(\phi_a\phi_b)\phi_c$ or $\phi_a(\phi_b\phi_c)$.
Applying compatibility condition (1), the first composition is $(\ad(g_{a,b})\phi_{ab})\phi_c$ we then apply (1) again to get
\[
	(\phi_a\phi_b)\phi_c = \ad(g_{a,b})\ad(g_{ab,c})\phi_{abc} = \ad(g_{a,b}g_{ab,c})\phi_{abc}
	.\]
Similarly, with the second composition, we get
\[
	\phi_a(\phi_b\phi_c) = \phi_a\ad(g_{b,c})\phi_{bc} = \ad(\phi_a(g_{b,c}))\phi_a\phi_{bc} = \ad(\phi_a(g_{b,c})g_{a,bc})\phi_{abc}
	.\]
Without any knowledge of the group $G_\nu$, in order to guarantee associativity of composition, we require compatibility condition (2).

We now define a complex of groups associated to an action.
In some sense, this is the natural context of complexes of groups and motivates  \cref{def:complex_of_groups}.
It is in fact true that we can fully recover $G$, $\catx$ and the action from this information, but this is something we will not discuss.
See REF for more details.
\begin{definition}
	Suppose we have $\catx$, $G$, $G \backslash \catx$ and $p \colon G \to G \backslash \catx$ as described after \cref{def:action_of_groups_on_scwols}.
	Denote the scwol $G \backslash \catx$ by $\caty$.
	Let $s \colon V(\caty) \to V(\catx)$ be a section (as sets) of $p|_{V(\catx)}$.
	The complex of groups over the scwol $\caty$ associated to the action of $G$, denoted $G(\caty)$ is defined as follows.
	We define the local groups of $G(\caty)$ as the stabilisers under this section, $G_\sigma \coloneq \stab(s(\sigma))$.
	Since $p$ is non-degenerate, for each $a \in E(\caty)$ with $i(a) = \sigma$, there exists a unique $\tilde{a} \in E(\catx)$ such that $i(\tilde{a}) = s(\sigma)$ and $p(\tilde{a}) = a$.
	However, there is no guarantee that $t(\tilde{a}) = s(t(a))$.
	Choose some $h_a \in G$ such that $h_a \cdot t(\tilde{a}) = s(t(a))$.
	Do this for every edge in $E(\caty)$.
	We define the edge homomorphisms of $G(\caty)$ to be $\phi_a \coloneq \ad(h_a^{-1})$.
	We define the twisting elements of $G(\caty)$ to be $g_{a,b} \coloneq h_ah_bh_{ab}^{-1}$.
	\label{def:complex_of_groups_from_action}
\end{definition}

There is a choice involved in defining the section $s$.
Had we chosen different representatives $s^\prime(\sigma)$, the resulting  subgroup $\stab(s^\prime(\sigma))$ would be conjugate to $\stab(s(\sigma))$.

We now check that, if $g \in G_{i(a)}$, then  $\phi_a(g) \in G_{t(a)}$ as required.
Observe that $h_a^{-1} \cdot s(t(a)) = t(\tilde{a})$ by construction.
Then, because $g \in \stab(i(\tilde{a}))$, and because  $g$ acts non-degenerately,  $g \in \stab(t(\tilde{a}))$.
So  $gh_a^{-1} \cdot s(t(a)) = t(\tilde{a})$, so $\phi_a(g) \cdot s(t(a)) = s(t(a))$ and  $\phi_a(g) \in G_{t(a)}$.
We see that $h_a^{-1}$ is exactly the correct element to conjugate by to account for the (sometimes inevitable) fact that the section $s$ is discontinuous and maps in to multiple fundamental domains of $\catx$.

In the context above, given a well-chosen $h_a$ and some $h \in G_{i(a)}$, we see that $h^\prime_a = h_ah$, would also serve the function of $h_a$.
So, there is ambiguity in that choice.
The $g_{a,b}$ account for the fact that we if we were to compare the two guaranteed possible paths along a composable edge, then we may have (sometimes, inevitably) choosen our $h_a$ inconsistently.
This is shown in the diagram below.

\begin{center}
	\begin{tikzpicture}
		\def\size{3}
		\tikzstyle{every label}=[font=\footnotesize]
		\tikzstyle{every node}=[font=\footnotesize]

		\node[FSC] (l) at (0,0)					{};
		\node[FSC] (r) at ($(l)+(\size,0)$)			{};
		\node[FSC] (b) at ($(l)!0.5!(r)+(0,-0.15*\size)$)	{};

		\node (u) at ($(l)!0.5!(r)+(0,0.3*\size)$) {$g \mapsto h_{ab}gh_{ab}^{-1}$};
		\node (d) at ($(l)!0.5!(r)+(0,-0.3*\size)$) {$g \mapsto h_{a}h_{b}g(h_{a}h_{b})^{-1}$};

		\draw[arrow_me=stealth, bend left=30] (l) to node[below] {$ab$} (r);
		\draw[arrow_me=stealth, bend right=10] (l) to node[above] {$b$} (b);
		\draw[arrow_me=stealth, bend right=10] (b) to node[above] {$a$} (r);
		% \draw[arrow_me=stealth, bend left=90] (bot) to node[left] {$ab$} (top);
	\end{tikzpicture}
\end{center}

\begin{example}
	Consider the polyhedral complex consisting of two squares sharing an edge, this is realised as a scwol $\catx$, shown in the following diagram.

	\begin{center}
		\begin{tikzpicture}
			\def\sqsize{2}
			\tikzstyle{every label}=[font=\footnotesize]
			\tikzstyle{every node}=[font=\footnotesize]

			% First square nodes
			\node[FSC] (bl)	at (0,0)	{};
			\node[FSC, fill=red] (br)	at ($(bl)+(\sqsize,0)$)	{};
			\node[FSC] (tl)	at ($(bl)+(0,\sqsize)$)	{};
			\node[FSC, fill=red] (tr)	at ($(tl)+(\sqsize,0)$)	{};

			\node[FSC] (mblbr) at ($(bl)!0.5!(br)$) {};
			\node[FSC] (mbltl) at ($(bl)!0.5!(tl)$) {};
			\node[FSC, fill=red] (mbrtr) at ($(br)!0.5!(tr)$) {};
			\node[FSC] (mtltr) at ($(tl)!0.5!(tr)$) {};

			\node[FSC] (center) at ($(bl)!0.5!(tr)$) {};

			% Second square nodes (mirrored to the right)
			\node[FSC] (br2)	at ($(br)+(\sqsize,0)$)	{};
			\node[FSC] (tr2)	at ($(tr)+(\sqsize,0)$)	{};

			\node[FSC] (mbrbr2) at ($(br)!0.5!(br2)$) {};
			\node[FSC] (mtrtr2) at ($(tr)!0.5!(tr2)$) {};
			\node[FSC] (mbr2tr2) at ($(br2)!0.5!(tr2)$) {};

			\node[FSC] (center2) at ($(br)!0.5!(tr2)$) {};

			% Arrows for first square
			\draw[arrow_me=stealth] (center) to (bl);
			\draw[arrow_me=stealth] (center) to (br);
			\draw[arrow_me=stealth] (center) to (tl);
			\draw[arrow_me=stealth] (center) to (tr);

			\draw[arrow_me=stealth] (center) to (mblbr);
			\draw[arrow_me=stealth] (center) to (mbltl);
			\draw[arrow_me=stealth] (center) to (mtltr);
			\draw[arrow_me=stealth] (center) to (mbrtr);

			\draw[arrow_me=stealth] (mblbr) to (bl);
			\draw[arrow_me=stealth] (mblbr) to (br);
			\draw[arrow_me=stealth] (mbltl) to (bl);
			\draw[arrow_me=stealth] (mbltl) to (tl);
			\draw[arrow_me=stealth, red] (mbrtr) to (br);
			\draw[arrow_me=stealth, red] (mbrtr) to (tr);
			\draw[arrow_me=stealth] (mtltr) to (tl);
			\draw[arrow_me=stealth] (mtltr) to (tr);

			% Arrows for second square
			\draw[arrow_me=stealth] (center2) to (br);
			\draw[arrow_me=stealth] (center2) to (br2);
			\draw[arrow_me=stealth] (center2) to (tr);
			\draw[arrow_me=stealth] (center2) to (tr2);

			\draw[arrow_me=stealth] (center2) to (mbrbr2);
			\draw[arrow_me=stealth] (center2) to (mbrtr);
			\draw[arrow_me=stealth] (center2) to (mtrtr2);
			\draw[arrow_me=stealth] (center2) to (mbr2tr2);

			\draw[arrow_me=stealth] (mbrbr2) to (br);
			\draw[arrow_me=stealth] (mbrbr2) to (br2);
			\draw[arrow_me=stealth] (mtrtr2) to (tr);
			\draw[arrow_me=stealth] (mtrtr2) to (tr2);
			\draw[arrow_me=stealth] (mbr2tr2) to (br2);
			\draw[arrow_me=stealth] (mbr2tr2) to (tr2);
		\end{tikzpicture}
	\end{center}

	There is an action of $G = \Z / 2\Z$ on this scwol by reflecting in the line realised by the subscwol highlighted in red.
	The quotient scwol $\caty = G \backslash \catx$ is shown below.
	\begin{center}
		\begin{tikzpicture}
			\def\sqsize{2}
			\tikzstyle{every label}=[font=\footnotesize]
			\tikzstyle{every node}=[font=\footnotesize]

			% First square nodes
			\node[FSC] (bl)	at (0,0)	{};
			\node[FSC, fill=red] (br)	at ($(bl)+(\sqsize,0)$)	{};
			\node[FSC] (tl)	at ($(bl)+(0,\sqsize)$)	{};
			\node[FSC, fill=red] (tr)	at ($(tl)+(\sqsize,0)$)	{};

			\node[FSC] (mblbr) at ($(bl)!0.5!(br)$) {};
			\node[FSC] (mbltl) at ($(bl)!0.5!(tl)$) {};
			\node[FSC, fill=red] (mbrtr) at ($(br)!0.5!(tr)$) {};
			\node[FSC] (mtltr) at ($(tl)!0.5!(tr)$) {};

			\node[FSC] (center) at ($(bl)!0.5!(tr)$) {};

			% Arrows for first square
			\draw[arrow_me=stealth] (center) to (bl);
			\draw[arrow_me=stealth] (center) to (br);
			\draw[arrow_me=stealth] (center) to (tl);
			\draw[arrow_me=stealth] (center) to (tr);

			\draw[arrow_me=stealth] (center) to (mblbr);
			\draw[arrow_me=stealth] (center) to (mbltl);
			\draw[arrow_me=stealth] (center) to (mtltr);
			\draw[arrow_me=stealth] (center) to (mbrtr);

			\draw[arrow_me=stealth] (mblbr) to (bl);
			\draw[arrow_me=stealth] (mblbr) to (br);
			\draw[arrow_me=stealth] (mbltl) to (bl);
			\draw[arrow_me=stealth] (mbltl) to (tl);
			\draw[arrow_me=stealth, red] (mbrtr) to (br);
			\draw[arrow_me=stealth, red] (mbrtr) to (tr);
			\draw[arrow_me=stealth] (mtltr) to (tl);
			\draw[arrow_me=stealth] (mtltr) to (tr);

		\end{tikzpicture}
	\end{center}
	In the resulting complex of groups $G(\caty)$, the local groups of the red vertices are $G$ and the other local groups are trivial.
	All the injective homomorphisms are determined by these groups and all the twisting elements are trivial.
\end{example}

Given any polyhedral complex, we could construct such an example as above.
In this context, the geometric requirements on the action are as follows.
\begin{enumerate}
	\item The action respects the cell structure and acts by homeomorphisms when restricted to cells.
	\item If an open cell is fixed setwise, then it is fixed pointwise.
\end{enumerate}
Given these two conditions, the quotient scwol realises the quotient polyhedral complex (which is again a polyhedral complex, thanks to condition (2)).
The stabiliser of a cell is automatically a subgroup of the stabilisers of each of its faces, and we get a complex of groups in this way.

\begin{definition}
	Let $\catx$ and $\catx^\prime$ be two scwols, and let $G(\catx) = (G_\sigma, \phi_a, g_{a,b})$ and  $G(\catx^\prime) = (G^\prime_\sigma, \phi^\prime_a, g^\prime_{a,b})$ be two complexes of groups, neither of which are necessarily associated to a group action.
	Given a possibly degenerate morphism of scwols $f \colon \catx \to \catx^\prime$, a morphism of complexes of groups over $f$ is some $\psi  \colon G(\catx) \to G(\catx^\prime)$ which consists of the following data:
	\begin{enumerate}
		\item A homomorphism $\psi_\sigma \colon G_\sigma \to G_{f(\sigma)}$ for all $\sigma \in V(\catx) $.
		\item An element $\theta \in G_{t(f(a))}$ for all $a \in E(\catx)$ such that:
		      \begin{enumerate}[(i)]
			      \item $\ad(\theta_a)\phi'_{f(a)}\psi_{i(a)}=\psi_{t(a)}\phi_a$ for all $a \in E(\catx)$.
			      \item $\psi_{t(a)}(g_{a,b}) = \theta_a\phi_{f(a)}(\theta_b)g_{f(a),f(b)}\theta_{ab}^{-1}$ for all $(b,a) \in E^{(2)}(\catx)$.
		      \end{enumerate}
	\end{enumerate}
	We say $\phi$ over $f$ is an isomorphism if $f$ is an isomorphism of scwols and each $\phi_\sigma$ is an isomorphism.
	\label{def:morhpism_of_complexes_of_groups}
\end{definition}

Condition (i) says that the square of an edge $a$ commutes up to conjugation by a chosen element $\theta_a$, i.e.~in the following diagram, $\psi_\tau \phi_a = \ad(\theta_a) \phi^\prime_{f(a)} \psi_\sigma$.
\begin{equation}
	\begin{tikzcd}
		G_\sigma \ar[d, "\psi_\sigma"] \ar[r, "\phi_a"] & G_\tau \ar[d, "\psi_\tau"]\\
		G^\prime_{f(\sigma)} \ar[r, "\phi^\prime_{f(a)}"] & G^\prime_{f(\tau)}
	\end{tikzcd}
	\label{eq:commuativity_sq_cx_morphism}
\end{equation}


To understand condition (i), we should bear in mind the discussion following \cref{def:complex_of_groups_from_action}.
We only require squares like \eqref{eq:commuativity_sq_cx_morphism} to commute up to some conjugation because when defining our homomorphisms $\phi_a$ in \cref{def:complex_of_groups_from_action}, there was an ambiguity up to such a conjugation, which could only be resolved by an arbitrary choice.

Condition (ii) says that, bearing in mind how squares like \eqref{eq:commuativity_sq_cx_morphism} commute, in the following diagram, we should have $\phi^\prime_{f(ab)}\psi_\sigma  = \phi^\prime_{f(a)f(b)}\psi_\sigma$.
\begin{equation}
	\begin{tikzcd}
		G_\sigma \ar[d, "\psi_\sigma"] \ar[r, "\phi_b"] \ar[rr, bend left, "\phi_{ab}"] & G_\tau \ar[d, "\psi_\tau"] \ar[r, "\phi_a"] & G_\nu \ar[d, "\psi_\nu"]\\
		G^\prime_{f(\sigma)} \ar[rr, bend right, "\phi^\prime_{f(a)f(b)}"'] \ar[rr, bend right=90, "\phi^\prime_{f(ab)}"'] \ar[r, "\phi^\prime_{f(b)}"] & G^\prime_{f(\tau)} \ar[r, "\phi^\prime_{f(a)}"] & G^\prime_{f(\nu)}
	\end{tikzcd}
	\label{eq:commutativity_double_sq_cx_morphism}
\end{equation}

We will go through the computation that shows this.
If we apply condition (i) to the composition $\psi_\nu \phi_{ab}$, we get $\psi_\nu\phi_{ab} = \ad(\theta_{ab})\phi^\prime_{f(ab)}\psi_\sigma$.
Since $G(\catx)$ is a complex of groups, we have $\ad(g_{a,b})\phi_{ab} = \phi_a\phi_b$.
Putting these together, we get
\begin{align*}
	\ad(\psi_\nu(g_{a,b})\theta_{ab})\phi^\prime_{f(ab)}\psi_\sigma
	 & = \ad(\psi_\nu(g_{a,b}))\psi_\nu\phi_{ab} \\
	 & = \psi_\nu\ad(g_{a,b})\phi_{a,b}          \\
	 & = \psi_\nu\phi_a\phi_b
	.
\end{align*}
Then, applying the condition (i) twice
\begin{align*}
	\psi_\nu\phi_a\phi_b
	= \ad(\theta_a)\phi^\prime_{f(a)}\psi_\tau\phi_b
	 & = \ad(\theta_a)\phi^\prime_{f(a)}\ad(\theta_b)\phi^\prime_{f(b)}\psi_\sigma                \\
	 & = \ad(\theta_a\phi^\prime_{f(a)}(\theta_b))\phi^\prime_{f(a)}\phi^\prime_{f(b)}\psi_\sigma
	.
\end{align*}
Then, since $G(\catx^\prime)$ is a complex of groups, we have $\ad(g^\prime_{f(a),f(b)})\phi^\prime_{f(a)f(b)} = \phi^\prime_{f(b)}\phi^\prime_{f(a)}$.
All together, we have
\begin{align*}
	\ad(\psi_\nu(g_{a,b})\theta_{ab})\phi^\prime_{f(ab)}\psi_\sigma = \ad(\theta_a\phi^\prime_{f(a)}(\theta_b)g^\prime_{f(a),f(b)})\phi^\prime_{f(a)f(b)}\psi_\sigma
	.
\end{align*}
Thus, condition (ii) guarantees $\psi_\nu(g_{a,b})\theta_{ab} = \theta_a\phi^\prime_{f(a)}(\theta_b)g^\prime_{f(a),f(b)}$ and thus $\phi^\prime_{f(ab)}\psi_\sigma = \phi^\prime_{f(a)f(b)}\psi_\sigma$.
Condition (ii) ensures that $\psi_\nu\phi_{ab}$ unambiguously commutes in the following diagram, thus we only need to define one $\theta_{ab}$.

\begin{equation*}
	\begin{tikzcd}
		G_\sigma \ar[d, "\psi_\sigma"] \ar[rr, "\phi_{ab}"] & &  G_\nu \ar[d, "\psi_\nu"]\\
		G^\prime_{f(\sigma)} \ar[rr, bend right, "\phi^\prime_{f(a)f(b)}"'] \ar[rr, bend left, "\phi^\prime_{f(ab)}"'] & & G^\prime_{f(\nu)}
	\end{tikzcd}
\end{equation*}

\begin{definition}
	A complex of groups is called \emph{developable} if it is isomorphic to a complex of groups emerging from an action of a group on a scwol, as in \cref{def:action_of_groups_on_scwols}.
\end{definition}

We also emphasise the following important morphism of complexes of groups.
A group $G$ can be realised as a complex of groups over the trivial scwol, consisting of one vertex and zero (non-identity) edges.
In this way, the following definition is a specific case of \cref{def:morhpism_of_complexes_of_groups}.

\begin{definition}
	A morphism from a complex of groups $G(\catx) = (G_\sigma, \phi_a, g_{a,b})$ to a group $G$ consists of the following data.
	\begin{enumerate}
		\item A homomorphism $\psi \colon G_\sigma \to G$ for all $\sigma \in V(G(\catx))$.
		\item An element $\theta_a \in G$ for all $a \in E(G(\catx))$ such that:
		      \begin{enumerate}[(i)]
			      \item $\psi_{t(a)}\phi_a = \ad(\theta_a)\psi_{i(a)}$
			      \item $\psi_{t(a)}(g_{a,b}) = \theta_a\theta_b\theta_{ab}^{-1}$.
		      \end{enumerate}
	\end{enumerate}
\end{definition}
